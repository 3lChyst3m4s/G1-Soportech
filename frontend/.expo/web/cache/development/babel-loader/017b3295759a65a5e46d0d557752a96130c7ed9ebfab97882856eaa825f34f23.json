{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport RefreshControl from \"react-native-web/dist/exports/RefreshControl\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport styles from \"./styles\";\nimport { UserMessage } from \"../../../../components/UserMessage\";\nimport { MessageInput } from \"../MessageInput\";\nimport { useAuth } from \"../../../../context/AuthContext\";\nimport { useRequest } from \"../../../../context/RequestContext\";\nimport { getMessages } from \"../../../../Api\";\nimport { updateRequest } from \"../../../../Api\";\nimport { createForm } from \"../../../../Api\";\nimport { Button } from \"../../../../components/Button\";\nimport { Ionicons } from '@expo/vector-icons';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar LogContainer = function LogContainer(_ref) {\n  var _ref2, _ref3;\n  var itemId = _ref.itemId;\n  var _useAuth = useAuth(),\n    user = _useAuth.user;\n  var _useRequest = useRequest(),\n    request = _useRequest.request,\n    log = _useRequest.log;\n  var id = request.requestId;\n  var _useState = useState(request.answerForm === null),\n    _useState2 = _slicedToArray(_useState, 2),\n    showForm = _useState2[0],\n    setShowForm = _useState2[1];\n  var _useState3 = useState(0),\n    _useState4 = _slicedToArray(_useState3, 2),\n    rating = _useState4[0],\n    setRating = _useState4[1];\n  var _useState5 = useState(''),\n    _useState6 = _slicedToArray(_useState5, 2),\n    comment = _useState6[0],\n    setComment = _useState6[1];\n  var _useState7 = useState([]),\n    _useState8 = _slicedToArray(_useState7, 2),\n    messages = _useState8[0],\n    setMessages = _useState8[1];\n  var _useState9 = useState(false),\n    _useState10 = _slicedToArray(_useState9, 2),\n    refreshing = _useState10[0],\n    setRefreshing = _useState10[1];\n  var flatListRef = useRef(null);\n  var loadMessages = function loadMessages() {\n    return (_ref2 = _ref2 || _asyncToGenerator(function* () {\n      var res = yield getMessages(itemId);\n      var data = yield res.data;\n      setMessages(data);\n    })).apply(this, arguments);\n  };\n  var handleRating = function handleRating(star) {\n    setRating(star);\n  };\n  var handleComment = function handleComment(text) {\n    setComment(text);\n  };\n  var onSubmit = function onSubmit() {\n    return (_ref3 = _ref3 || _asyncToGenerator(function* () {\n      yield updateRequest(id, {\n        answerForm: comment\n      });\n      yield createForm({\n        id: id,\n        starCount: rating\n      });\n      setRating(0);\n      setComment('');\n      setShowForm(false);\n    })).apply(this, arguments);\n  };\n  var renderMessage = function renderMessage(_ref4) {\n    var item = _ref4.item;\n    return _jsx(UserMessage, {\n      userId: item.userId,\n      content: item.content,\n      sentTime: item.sentTime,\n      local: item.userId === user.userId\n    });\n  };\n  useEffect(function () {\n    loadMessages();\n  }, [messages]);\n  var onRefresh = React.useCallback(_asyncToGenerator(function* () {\n    setRefreshing(true);\n    yield loadMessages();\n    setRefreshing(false);\n  }), []);\n  return _jsxs(View, {\n    style: styles.logContainer,\n    children: [showForm && _jsxs(View, {\n      style: styles.form,\n      children: [_jsx(Text, {\n        style: styles.formTitle,\n        children: \"Formulario de Respuesta\"\n      }), _jsxs(View, {\n        style: styles.ratingContainer,\n        children: [_jsx(Text, {\n          style: styles.ratingText,\n          children: \"Punt\\xFAa el servicio:\"\n        }), _jsx(View, {\n          style: styles.starsContainer,\n          children: [1, 2, 3, 4, 5].map(function (star) {\n            return _jsx(Ionicons, {\n              name: star <= rating ? 'star' : 'star-outline',\n              size: 24,\n              color: star <= rating ? 'gold' : 'gray',\n              onPress: function onPress() {\n                return handleRating(star);\n              }\n            }, star);\n          })\n        })]\n      }), _jsx(TextInput, {\n        style: styles.commentInput,\n        placeholder: \"Escribe un comentario...\",\n        multiline: true,\n        value: comment,\n        onChangeText: handleComment\n      }), _jsx(Button, {\n        text: 'Enviar',\n        buttonStyle: styles.submitButton,\n        onPress: onSubmit,\n        color: 'persian-blue'\n      })]\n    }), _jsx(View, {\n      style: styles.messageContainer,\n      children: _jsx(FlatList, {\n        ref: flatListRef,\n        data: messages,\n        keyExtractor: function keyExtractor(item) {\n          return item.messageId + '';\n        },\n        renderItem: renderMessage,\n        onContentSizeChange: function onContentSizeChange() {\n          return flatListRef.current.scrollToEnd({\n            animated: false\n          });\n        },\n        refreshControl: _jsx(RefreshControl, {\n          refreshing: refreshing,\n          onRefresh: onRefresh\n        })\n      })\n    }), request.stateId === 1 && _jsx(MessageInput, {\n      logId: log.logId\n    })]\n  });\n};\nexport default LogContainer;","map":{"version":3,"names":["React","useState","useEffect","useRef","FlatList","RefreshControl","View","Text","TextInput","styles","UserMessage","MessageInput","useAuth","useRequest","getMessages","updateRequest","createForm","Button","Ionicons","jsx","_jsx","jsxs","_jsxs","LogContainer","_ref","_ref2","_ref3","itemId","_useAuth","user","_useRequest","request","log","id","requestId","_useState","answerForm","_useState2","_slicedToArray","showForm","setShowForm","_useState3","_useState4","rating","setRating","_useState5","_useState6","comment","setComment","_useState7","_useState8","messages","setMessages","_useState9","_useState10","refreshing","setRefreshing","flatListRef","loadMessages","_asyncToGenerator","res","data","apply","arguments","handleRating","star","handleComment","text","onSubmit","starCount","renderMessage","_ref4","item","userId","content","sentTime","local","onRefresh","useCallback","style","logContainer","children","form","formTitle","ratingContainer","ratingText","starsContainer","map","name","size","color","onPress","commentInput","placeholder","multiline","value","onChangeText","buttonStyle","submitButton","messageContainer","ref","keyExtractor","messageId","renderItem","onContentSizeChange","current","scrollToEnd","animated","refreshControl","stateId","logId"],"sources":["C:/Users/USER/Downloads/G1-Soportechv13/Test/frontend/users/client/components/LogContainer/LogContainer.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react'\r\nimport { FlatList, RefreshControl, View, Text, TextInput } from 'react-native'\r\n\r\nimport styles from './styles';\r\nimport { UserMessage } from '../../../../components/UserMessage';\r\nimport { MessageInput } from '../MessageInput';\r\n\r\nimport { useAuth } from '../../../../context/AuthContext';\r\nimport { useRequest } from '../../../../context/RequestContext';\r\n\r\nimport { getMessages } from '../../../../Api';\r\nimport { updateRequest } from '../../../../Api';\r\nimport { createForm } from '../../../../Api';\r\n\r\nimport { Button } from '../../../../components/Button';\r\nimport { Ionicons } from '@expo/vector-icons';\r\n\r\nconst LogContainer = ({ itemId }) => {\r\n  const { user } = useAuth();\r\n  const { request, log } = useRequest();\r\n\r\n  const id = request.requestId;\r\n\r\n  const [showForm, setShowForm] = useState(request.answerForm === null);\r\n  const [rating, setRating] = useState(0);\r\n  const [comment, setComment] = useState('');\r\n  const [messages, setMessages] = useState([]);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const flatListRef = useRef(null);\r\n\r\n  const loadMessages = async () => {\r\n    const res = await getMessages(itemId);\r\n    const data = await res.data;\r\n    setMessages(data);\r\n  }\r\n\r\n  const handleRating = (star) => {\r\n    setRating(star);\r\n  };\r\n\r\n  const handleComment = (text) => {\r\n    setComment(text);\r\n  };\r\n\r\n  const onSubmit = async () => {\r\n    await updateRequest(id, { answerForm: comment });\r\n    await createForm({ id, starCount: rating });\r\n    setRating(0);\r\n    setComment('');\r\n    setShowForm(false);\r\n  };\r\n\r\n  const renderMessage = ({ item }) => {\r\n    return <UserMessage userId={item.userId} content={item.content} sentTime={item.sentTime} local={item.userId === user.userId}/>\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadMessages();\r\n  }, [messages]);\r\n\r\n  const onRefresh = React.useCallback(async () => {\r\n    setRefreshing(true);\r\n    await loadMessages();\r\n    setRefreshing(false);\r\n  }, []);\r\n\r\n  return (\r\n    <View style={styles.logContainer}>\r\n      { showForm && (\r\n        <View style={styles.form}>\r\n          <Text style={styles.formTitle}>Formulario de Respuesta</Text>\r\n          <View style={styles.ratingContainer}>\r\n            <Text style={styles.ratingText}>Punt√∫a el servicio:</Text>\r\n            <View style={styles.starsContainer}>\r\n              {[1, 2, 3, 4, 5].map((star) => (\r\n                <Ionicons\r\n                  key={star}\r\n                  name={star <= rating ? 'star' : 'star-outline'}\r\n                  size={24}\r\n                  color={star <= rating ? 'gold' : 'gray'}\r\n                  onPress={() => handleRating(star)}\r\n                />\r\n              ))}\r\n            </View>\r\n          </View>\r\n          <TextInput\r\n            style={styles.commentInput}\r\n            placeholder=\"Escribe un comentario...\"\r\n            multiline={true}\r\n            value={comment}\r\n            onChangeText={handleComment}\r\n          />\r\n          <Button\r\n            text={'Enviar'}\r\n            buttonStyle={styles.submitButton}\r\n            onPress={onSubmit}\r\n            color={'persian-blue'}\r\n          />\r\n        </View>\r\n      )}\r\n\r\n      <View style={styles.messageContainer}>\r\n        <FlatList\r\n          ref={flatListRef}\r\n          data={messages}\r\n          keyExtractor={(item) => item.messageId + ''}\r\n          renderItem={renderMessage}\r\n          onContentSizeChange={() => flatListRef.current.scrollToEnd({ animated: false })}\r\n          refreshControl={\r\n            <RefreshControl\r\n              refreshing={refreshing}\r\n              onRefresh={onRefresh}\r\n            />\r\n          }\r\n        />\r\n      </View>\r\n      { request.stateId === 1 && (\r\n        <MessageInput \r\n          logId={log.logId}\r\n        />\r\n      )}\r\n    </View>\r\n  )\r\n}\r\n\r\nexport default LogContainer"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}